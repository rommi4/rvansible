<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Conversation with d_fakhrtdinov@wargaming.net at Fri 20 Feb 2015 12:53:08 PM MSK on r_verenich@wargaming.net/ (jabber)</title></head><body><h3>Conversation with d_fakhrtdinov@wargaming.net at Fri 20 Feb 2015 12:53:08 PM MSK on r_verenich@wargaming.net/ (jabber)</h3>
<font color="#16569E"><font size="2">(12:56:13 PM)</font> <b>Roman Verenich:</b></font> Денис, привет!<br/><br/>Помоги плз, глянь выпуклым глазом:<br/>создаю комнату в чате wowslo1 (2.10 чат)<br/>чат работает, но при запуске <br/>xmpp-muc-manage --create <br/>такой output:<br/><br/>$ tail -f /var/log/jd/debug.log | grep chat_channel_talk_ru<br/> 2015-02-20 09:52:35.686 [debug] &lt;0.6344.0&gt; jd_c2s_im_router_satellite, handle_call_route, agent_pid: &lt;0.6337.0&gt;, full_jid: &lt;&lt;&quot;admin-1@admin.wowslo1.loc/resource2374332421&quot;&gt;&gt;, from: {jid,&lt;&lt;&quot;admin-1&quot;&gt;&gt;,&lt;&lt;&quot;admin.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;resource2374332421&quot;&gt;&gt;}, to: {jid,&lt;&lt;&quot;chat_channel_talk_ru&quot;&gt;&gt;,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;ServerBot&quot;&gt;&gt;}, stanza: {xe,&lt;&lt;&quot;presence&quot;&gt;&gt;,&lt;&lt;&quot;jabber:client&quot;&gt;&gt;,[{&lt;&lt;&quot;from&quot;&gt;&gt;,&lt;&lt;&quot;admin-1@admin.wowslo1.loc/resource2374332421&quot;&gt;&gt;},{&lt;&lt;&quot;to&quot;&gt;&gt;,&lt;&lt;&quot;chat_channel_talk_ru@standard.wowslo1.loc/ServerBot&quot;&gt;&gt;},{&lt;&lt;&quot;xml:lang&quot;&gt;&gt;,&lt;&lt;&quot;en&quot;&gt;&gt;}],[{xe,&lt;&lt;&quot;x&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc">http://jabber.org/protocol/muc</a>&quot;&gt;&gt;,[],[{xe,&lt;&lt;&quot;history&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc">http://jabber.org/protocol/muc</a>&quot;&gt;&gt;,[{&lt;&lt;&quot;maxchars&quot;&gt;&gt;,&lt;&lt;&quot;0&quot;&gt;&gt;}],[],[],[]}],[],[]}],[],[]}<br/>2015-02-20 09:52:35.687 [debug] &lt;0.6344.0&gt; jd_c2s_im_router_satellite, job_add, spawn_instantly, priority: 10, f: #Fun&lt;jd_c2s_im_router_satellite.7.95570899&gt;, a: [{jid,&lt;&lt;&quot;admin-1&quot;&gt;&gt;,&lt;&lt;&quot;admin.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;resource2374332421&quot;&gt;&gt;},{jid,&lt;&lt;&quot;chat_channel_talk_ru&quot;&gt;&gt;,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;ServerBot&quot;&gt;&gt;},{xe,&lt;&lt;&quot;presence&quot;&gt;&gt;,&lt;&lt;&quot;jabber:client&quot;&gt;&gt;,[{&lt;&lt;&quot;from&quot;&gt;&gt;,&lt;&lt;&quot;admin-1@admin.wowslo1.loc/resource2374332421&quot;&gt;&gt;},{&lt;&lt;&quot;to&quot;&gt;&gt;,&lt;&lt;&quot;chat_channel_talk_ru@standard.wowslo1.loc/ServerBot&quot;&gt;&gt;},{&lt;&lt;&quot;xml:lang&quot;&gt;&gt;,&lt;&lt;&quot;en&quot;&gt;&gt;}],[{xe,&lt;&lt;&quot;x&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc">http://jabber.org/protocol/muc</a>&quot;&gt;&gt;,[],[{xe,&lt;&lt;&quot;history&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc">http://jabber.org/protocol/muc</a>&quot;&gt;&gt;,[{&lt;&lt;&quot;maxchars&quot;&gt;&gt;,&lt;&lt;&quot;0&quot;&gt;&gt;}],[],[],[]}],[],[]}],[],[]},&lt;0.6337.0&gt;]<br/>2015-02-20 09:52:35.687 [debug] &lt;0.6344.0&gt; jd_c2s_im_router_satellite, handle_call_route, agent_pid: &lt;0.6337.0&gt;, full_jid: &lt;&lt;&quot;admin-1@admin.wowslo1.loc/resource2374332421&quot;&gt;&gt;, from: {jid,&lt;&lt;&quot;admin-1&quot;&gt;&gt;,&lt;&lt;&quot;admin.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;resource2374332421&quot;&gt;&gt;}, to: {jid,&lt;&lt;&quot;chat_channel_talk_ru&quot;&gt;&gt;,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&gt;&gt;}, stanza: {xe,&lt;&lt;&quot;iq&quot;&gt;&gt;,&lt;&lt;&quot;jabber:client&quot;&gt;&gt;,[{&lt;&lt;&quot;from&quot;&gt;&gt;,&lt;&lt;&quot;admin-1@admin.wowslo1.loc/resource2374332421&quot;&gt;&gt;},{&lt;&lt;&quot;to&quot;&gt;&gt;,&lt;&lt;&quot;<a href="mailto:chat_channel_talk_ru@standard.wowslo1.loc">chat_channel_talk_ru@standard.wowslo1.loc</a>&quot;&gt;&gt;},{&lt;&lt;&quot;type&quot;&gt;&gt;,&lt;&lt;&quot;get&quot;&gt;&gt;},{&lt;&lt;&quot;id&quot;&gt;&gt;,&lt;&lt;&quot;17ceebca-aa0f-4dd5-887c-5ed05b15fdeb-4&quot;&gt;&gt;}],[{xe,&lt;&lt;&quot;query&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc#owner">http://jabber.org/protocol/muc#owner</a>&quot;&gt;&gt;,[],[],[],[]}],[],[]}<br/>2015-02-20 09:52:35.688 [debug] &lt;0.6344.0&gt; jd_c2s_im_router_satellite, job_add, enqueue, priority: 10, f: #Fun&lt;jd_c2s_im_router_satellite.7.95570899&gt;, a: [{jid,&lt;&lt;&quot;admin-1&quot;&gt;&gt;,&lt;&lt;&quot;admin.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;resource2374332421&quot;&gt;&gt;},{jid,&lt;&lt;&quot;chat_channel_talk_ru&quot;&gt;&gt;,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&gt;&gt;},{xe,&lt;&lt;&quot;iq&quot;&gt;&gt;,&lt;&lt;&quot;jabber:client&quot;&gt;&gt;,[{&lt;&lt;&quot;from&quot;&gt;&gt;,&lt;&lt;&quot;admin-1@admin.wowslo1.loc/resource2374332421&quot;&gt;&gt;},{&lt;&lt;&quot;to&quot;&gt;&gt;,&lt;&lt;&quot;<a href="mailto:chat_channel_talk_ru@standard.wowslo1.loc">chat_channel_talk_ru@standard.wowslo1.loc</a>&quot;&gt;&gt;},{&lt;&lt;&quot;type&quot;&gt;&gt;,&lt;&lt;&quot;get&quot;&gt;&gt;},{&lt;&lt;&quot;id&quot;&gt;&gt;,&lt;&lt;&quot;17ceebca-aa0f-4dd5-887c-5ed05b15fdeb-4&quot;&gt;&gt;}],[{xe,&lt;&lt;&quot;query&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc#owner">http://jabber.org/protocol/muc#owner</a>&quot;&gt;&gt;,[],[],[],[]}],[],[]},&lt;0.6337.0&gt;]<br/>2015-02-20 09:52:35.688 [warning] &lt;0.6356.0&gt; jd_c2s_im_router_satellite, job_execute, error: {case_clause,{error,[{reason,{case_clause,{badrpc,nodedown}}},{stack,[{jd_muc_occupant,join,4,[{file,&quot;src/jd_muc_occupant.erl&quot;},{line,73}]},{jd_muc_router,process_muc_presence_available,4,[{file,&quot;src/jd_muc_router.erl&quot;},{line,76}]},{jd_muc_router,safe_process_muc_stanza,4,[{file,&quot;src/jd_muc_router.erl&quot;},{line,39}]},{jd_muc_router,route,5,[{file,&quot;src/jd_muc_router.erl&quot;},{line,33}]},{hooks_hook_runner_beam,'#[{jd_router,route,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;}]',2,[]},{jd_router,run_route_pipeline,5,[{file,&quot;src/jd_router.erl&quot;},{line,52}]},{jd_debug,run_and_report_duration,2,[{file,&quot;src/jd_debug.erl&quot;},{line,32}]},{jd_c2s_im_router_satellite,job_route,4,[{file,&quot;src/jd_c2s_im_router_satellite.erl&quot;},{line,390}]}]}]}}, stack: [{jd_muc_router,route,5,[{file,&quot;src/jd_muc_router.erl&quot;},{line,33}]},{hooks_hook_runner_beam,'#[{jd_router,route,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;}]',2,[]},{jd_router,run_route_pipeline,5,[{file,&quot;src/jd_router.erl&quot;},{line,52}]},{jd_debug,run_and_report_duration,2,[{file,&quot;src/jd_debug.erl&quot;},{line,32}]},{jd_c2s_im_router_satellite,job_route,4,[{file,&quot;src/jd_c2s_im_router_satellite.erl&quot;},{line,390}]},{jd_c2s_im_router_satellite,job_execute,2,[{file,&quot;src/jd_c2s_im_router_satellite.erl&quot;},{line,374}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}], func: #Fun&lt;jd_c2s_im_router_satellite.7.95570899&gt;, args: [{jid,&lt;&lt;&quot;admin-1&quot;&gt;&gt;,&lt;&lt;&quot;admin.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;resource2374332421&quot;&gt;&gt;},{jid,&lt;&lt;&quot;chat_channel_talk_ru&quot;&gt;&gt;,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;ServerBot&quot;&gt;&gt;},{xe,&lt;&lt;&quot;presence&quot;&gt;&gt;,&lt;&lt;&quot;jabber:client&quot;&gt;&gt;,[{&lt;&lt;&quot;from&quot;&gt;&gt;,&lt;&lt;&quot;admin-1@admin.wowslo1.loc/resource2374332421&quot;&gt;&gt;},{&lt;&lt;&quot;to&quot;&gt;&gt;,&lt;&lt;&quot;chat_channel_talk_ru@standard.wowslo1.loc/ServerBot&quot;&gt;&gt;},{&lt;&lt;&quot;xml:lang&quot;&gt;&gt;,&lt;&lt;&quot;en&quot;&gt;&gt;}],[{xe,&lt;&lt;&quot;x&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc">http://jabber.org/protocol/muc</a>&quot;&gt;&gt;,[],[{xe,&lt;&lt;&quot;history&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc">http://jabber.org/protocol/muc</a>&quot;&gt;&gt;,[{&lt;&lt;&quot;maxchars&quot;&gt;&gt;,&lt;&lt;&quot;0&quot;&gt;&gt;}],[],[],[]}],[],[]}],[],[]},&lt;0.6337.0&gt;]<br/>2015-02-20 09:52:35.688 [warning] &lt;0.6359.0&gt; jd_c2s_im_router_satellite, job_execute, error: {case_clause,{badrpc,nodedown}}, stack: [{jd_muc_router,route,5,[{file,&quot;src/jd_muc_router.erl&quot;},{line,33}]},{hooks_hook_runner_beam,'#[{jd_router,route,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;}]',2,[]},{jd_router,run_route_pipeline,5,[{file,&quot;src/jd_router.erl&quot;},{line,52}]},{jd_debug,run_and_report_duration,2,[{file,&quot;src/jd_debug.erl&quot;},{line,32}]},{jd_c2s_im_router_satellite,job_route,4,[{file,&quot;src/jd_c2s_im_router_satellite.erl&quot;},{line,390}]},{jd_c2s_im_router_satellite,job_execute,2,[{file,&quot;src/jd_c2s_im_router_satellite.erl&quot;},{line,374}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}], func: #Fun&lt;jd_c2s_im_router_satellite.7.95570899&gt;, args: [{jid,&lt;&lt;&quot;admin-1&quot;&gt;&gt;,&lt;&lt;&quot;admin.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&quot;resource2374332421&quot;&gt;&gt;},{jid,&lt;&lt;&quot;chat_channel_talk_ru&quot;&gt;&gt;,&lt;&lt;&quot;standard.wowslo1.loc&quot;&gt;&gt;,&lt;&lt;&gt;&gt;},{xe,&lt;&lt;&quot;iq&quot;&gt;&gt;,&lt;&lt;&quot;jabber:client&quot;&gt;&gt;,[{&lt;&lt;&quot;from&quot;&gt;&gt;,&lt;&lt;&quot;admin-1@admin.wowslo1.loc/resource2374332421&quot;&gt;&gt;},{&lt;&lt;&quot;to&quot;&gt;&gt;,&lt;&lt;&quot;<a href="mailto:chat_channel_talk_ru@standard.wowslo1.loc">chat_channel_talk_ru@standard.wowslo1.loc</a>&quot;&gt;&gt;},{&lt;&lt;&quot;type&quot;&gt;&gt;,&lt;&lt;&quot;get&quot;&gt;&gt;},{&lt;&lt;&quot;id&quot;&gt;&gt;,&lt;&lt;&quot;17ceebca-aa0f-4dd5-887c-5ed05b15fdeb-4&quot;&gt;&gt;}],[{xe,&lt;&lt;&quot;query&quot;&gt;&gt;,&lt;&lt;&quot;<a href="http://jabber.org/protocol/muc#owner">http://jabber.org/protocol/muc#owner</a>&quot;&gt;&gt;,[],[],[],[]}],[],[]},&lt;0.6337.0&gt;]<br/><br/><br/>
<font color="#A82F2F"><font size="2">(12:58:59 PM)</font> <b>Denis Fakhrtdinov:</b></font> ,{case_clause,{badrpc,nodedown}<br/>
<font color="#A82F2F"><font size="2">(12:59:08 PM)</font> <b>Denis Fakhrtdinov:</b></font> У вас кластер помер.<br/>
<font color="#A82F2F"><font size="2">(12:59:29 PM)</font> <b>Denis Fakhrtdinov:</b></font> сделай jd attach<br/>
<font color="#A82F2F"><font size="2">(12:59:35 PM)</font> <b>Denis Fakhrtdinov:</b></font> Там nodes().<br/>
<font color="#A82F2F"><font size="2">(12:59:50 PM)</font> <b>Denis Fakhrtdinov:</b></font> ТОЛЬКО НЕ ВЫХОДИ ИЗ КОНСОЛИ ПО CTRL+C.<br/>
<font color="#A82F2F"><font size="2">(01:00:02 PM)</font> <b>Denis Fakhrtdinov:</b></font> Выходить из эрланговой консоли только по Ctrl+D.<br/>
<font color="#16569E"><font size="2">(01:00:44 PM)</font> <b>Roman Verenich:</b></font> [jdoperator@fr2-v-xmppcs-wowslo1-1 ~]$ jd attach<br/>Attaching to /opt/jd/tmp/pipes/erlang.pipe.1 (^D to exit)<br/><br/>nodes()<br/>(<a href="mailto:jd@fr2-v-xmppcs-wowslo1-1.wargaming.net">jd@fr2-v-xmppcs-wowslo1-1.wargaming.net</a>)1&gt; <br/><br/>
<font color="#A82F2F"><font size="2">(01:01:05 PM)</font> <b>Denis Fakhrtdinov:</b></font> Точку.<br/>
<font color="#A82F2F"><font size="2">(01:02:18 PM)</font> <b>Denis Fakhrtdinov:</b></font> shizz@shizz-worktop:~/code/wg/jd [develop [3db47d4] MOD] &gt; erl<br/>Erlang R15B03 (erts-5.9.3) [source] [64-bit] [smp:4:4] [async-threads:0] [hipe] [kernel-poll:false]<br/><br/>Eshell V5.9.3  (abort with ^G)<br/>1&gt; nodes().<br/>[]<br/>2&gt;<br/>
<font color="#16569E"><font size="2">(01:02:32 PM)</font> <b>Roman Verenich:</b></font> да<br/>
<font color="#A82F2F"><font size="2">(01:02:43 PM)</font> <b>Denis Fakhrtdinov:</b></font> Сколько нод?<br/>
<font color="#16569E"><font size="2">(01:02:49 PM)</font> <b>Roman Verenich:</b></font> 1<br/>
<font color="#A82F2F"><font size="2">(01:02:56 PM)</font> <b>Denis Fakhrtdinov:</b></font> А в кластере сколько?<br/>
<font color="#16569E"><font size="2">(01:03:10 PM)</font> <b>Roman Verenich:</b></font> стоп, возвращает?<br/>
<font color="#A82F2F"><font size="2">(01:03:24 PM)</font> <b>Denis Fakhrtdinov:</b></font> Да, что возвращает функция nodes()?<br/>
<font color="#16569E"><font size="2">(01:03:32 PM)</font> <b>Roman Verenich:</b></font> []<br/>
<font color="#A82F2F"><font size="2">(01:03:39 PM)</font> <b>Denis Fakhrtdinov:</b></font> А в кластере сколько нод?<br/>
<font color="#16569E"><font size="2">(01:03:41 PM)</font> <b>Roman Verenich:</b></font> 1<br/>
<font color="#A82F2F"><font size="2">(01:03:55 PM)</font> <b>Denis Fakhrtdinov:</b></font> Всего одна нода?<br/>
<font color="#16569E"><font size="2">(01:04:04 PM)</font> <b>Roman Verenich:</b></font> да<br/>
<font color="#A82F2F"><font size="2">(01:04:08 PM)</font> <b>Denis Fakhrtdinov:</b></font> Хмм, проверьте muc.nodes в конфигурации.<br/>
<font color="#16569E"><font size="2">(01:04:17 PM)</font> <b>Roman Verenich:</b></font> ок<br/>
<font color="#16569E"><font size="2">(01:06:53 PM)</font> <b>Roman Verenich:</b></font> muc.nodes.0 = <a href="mailto:jd@fr2-v-xmppcs-wowslo1-1">jd@fr2-v-xmppcs-wowslo1-1</a><br/><br/>config-effective:<br/>muc.nodes.0 = <a href="mailto:jd@fr2-v-xmppcs-wowslo1-1">jd@fr2-v-xmppcs-wowslo1-1</a><br/>на хосте [jdoperator@fr2-v-xmppcs-wowslo1-1 ~]$<br/><br/>
<font color="#A82F2F"><font size="2">(01:07:24 PM)</font> <b>Denis Fakhrtdinov:</b></font> А вызов функции node() в консоли возвращает эту же ноду?<br/>
<font color="#16569E"><font size="2">(01:07:55 PM)</font> <b>Roman Verenich:</b></font> [jdoperator@fr2-v-xmppcs-wowslo1-1 ~]$ jd attach<br/>Attaching to /opt/jd/tmp/pipes/erlang.pipe.1 (^D to exit)<br/><br/>nodes().<br/>[]<br/>(<a href="mailto:jd@fr2-v-xmppcs-wowslo1-1.wargaming.net">jd@fr2-v-xmppcs-wowslo1-1.wargaming.net</a>)3&gt; <br/><br/>
<font color="#A82F2F"><font size="2">(01:08:19 PM)</font> <b>Denis Fakhrtdinov:</b></font> node().<br/>
<font color="#16569E"><font size="2">(01:08:27 PM)</font> <b>Roman Verenich:</b></font> упс<br/>
<font color="#A82F2F"><font size="2">(01:08:37 PM)</font> <b>Denis Fakhrtdinov:</b></font> А, ну я уже вижу.<br/>
<font color="#16569E"><font size="2">(01:08:45 PM)</font> <b>Roman Verenich:</b></font> [jdoperator@fr2-v-xmppcs-wowslo1-1 ~]$ jd attach<br/>Attaching to /opt/jd/tmp/pipes/erlang.pipe.1 (^D to exit)<br/><br/>node().<br/>'jd@fr2-v-xmppcs-wowslo1-1.wargaming.net'<br/>(<a href="mailto:jd@fr2-v-xmppcs-wowslo1-1.wargaming.net">jd@fr2-v-xmppcs-wowslo1-1.wargaming.net</a>)4&gt; <br/><br/>
<font color="#A82F2F"><font size="2">(01:08:59 PM)</font> <b>Denis Fakhrtdinov:</b></font> <html xmlns='http://jabber.org/protocol/xhtml-im'><body xmlns='http://www.w3.org/1999/xhtml'><p>&gt;&gt; muc.nodes.0 = <a href="mailto:jd@fr2-v-xmppcs-wowslo1-1">jd@fr2-v-xmppcs-wowslo1-1</a><br/>&gt;&gt; <a href="mailto:&apos;jd@fr2-v-xmppcs-wowslo1-1.wargaming.net">&apos;jd@fr2-v-xmppcs-wowslo1-1.wargaming.net</a>&apos;</p></body></html><br/>
<font color="#A82F2F"><font size="2">(01:09:08 PM)</font> <b>Denis Fakhrtdinov:</b></font> Разница налицо.<br/>
<font color="#16569E"><font size="2">(01:14:58 PM)</font> <b>Roman Verenich:</b></font> ок, спасибо!<br/><br/>надо бы еще разобраться, почему на двух одинаковых хостах в одном короткое имя - работает, а на этом только после fqdn заработало<br/>хотя, мб не совсем одинаковые<br/>
<font color="#A82F2F"><font size="2">(01:25:30 PM)</font> <b>Denis Fakhrtdinov:</b></font> Есть разница между -name и -sname при запуске ноды.<br/>
</body></html>
